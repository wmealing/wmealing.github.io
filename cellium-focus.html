<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-10-22 Wed 13:45 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cellium Focus Concepts - Cellium 002</title>
<meta name="generator" content="Org Mode" />
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta http-equiv="Content-Security-Policy" content="style-src-elem 'self' https://wmealing.github.io;">
<link rel="stylesheet" href="index.css">
<meta name="author" content="Wade Mealing" />
<meta name="description" content="Introduction to cellium concepts" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Cellium Focus Concepts - Cellium 002</h1>
<div id="outline-container-orgf65881c" class="outline-2">
<h2 id="orgf65881c">Summary</h2>
<div class="outline-text-2" id="text-orgf65881c">
<p>
I started building <a href="https://github.com/wmealing/cellium">Cellium</a>, an Erlang <b><b>Text-User Interface (TUI)</b></b> library, to simplify creating basic user interfaces for my Erlang tooling. This article details the concept and implementation of <b><b>widget focus</b></b> within Cellium.
</p>
</div>
</div>
<div id="outline-container-org0f49cbc" class="outline-2">
<h2 id="org0f49cbc">Core Focus Concept</h2>
<div class="outline-text-2" id="text-org0f49cbc">
<p>
Widget focus is a standard design pattern in TUI and GUI development. It designates the currently active or target interactive <b><b>widget</b></b>, which must be distinguishable via a visual indicator.
</p>
</div>
<div id="outline-container-orgf4ae1e4" class="outline-3">
<h3 id="orgf4ae1e4">Visual Indication Examples:</h3>
<div class="outline-text-3" id="text-orgf4ae1e4">
<p>
Different widgets will have different ways of displaying they have 'focus'.
</p>

<ul class="org-ul">
<li><b><b>Highlighting:</b></b> Displaying the element with a distinct color, background, or border.</li>
<li><b><b>Obscuring:</b></b> Making non-interactive or unfocused items less bright or a duller color.</li>
<li><b><b>Cursor:</b></b> A blinking cursor within a focused input field.</li>
<li><b><b>Inversion:</b></b> Inverting the element's colors.</li>
<li><b><b>Labeling:</b></b> Applying a tag like `[Focused]` or `[Active]` to the widgets header or footer.</li>
</ul>
</div>
</div>
<div id="outline-container-org3f5cc1e" class="outline-3">
<h3 id="org3f5cc1e">Navigation</h3>
<div class="outline-text-3" id="text-org3f5cc1e">
<p>
Users typically navigate between focusable elements using standard key bindings:
</p>

<ul class="org-ul">
<li><b><b>Tab Key:</b></b> Moves focus <b>forward</b> through the sequence.</li>
<li><b><b>Shift + Tab:</b></b> Moves focus <b>backward</b> through the sequence.</li>
</ul>

<p>
A navigation aid is sometimes in the 'footer (or status bar)' of the terminal, but this is not a hard requirement.
</p>
</div>
</div>
</div>
<div id="outline-container-org861b122" class="outline-2">
<h2 id="org861b122">Focus Management Implementation</h2>
<div class="outline-text-2" id="text-org861b122">
<p>
Cellium provides an <b><b>optional, built-in default focus handler</b></b> to improve the developer experience (DX).
</p>

<p>
This default handler can be disabled, allowing you to implement manual focus logic, typically within your application's <code>update/2</code> function (where the application logic processes events such as key presses to change the model).
</p>

<p>
To disable the automatic focus handler, set `auto_focus` to `false` when starting the Cellium server:
</p>

<div class="org-src-container">
<pre class="src src-erlang">start() -&gt;
    cellium:start(#{module=&gt;?MODULE, auto_focus =&gt; false }).
</pre>
</div>
</div>
<div id="outline-container-org0da69a3" class="outline-3">
<h3 id="org0da69a3">Registering Focusable Widgets</h3>
<div class="outline-text-3" id="text-org0da69a3">
<p>
The <b><b>`focus_manager`</b></b> gen server tracks the list of focusable widgets, the current focus, and handles focus changes.
</p>

<p>
You must explicitly register a widget to include it in the focus chain using its unique identifier:
</p>

<div class="org-src-container">
<pre class="src src-erlang">focus_manager:register_widget(WidgetID).
</pre>
</div>

<p>
<b><b>Design Rationale:</b></b> Requiring explicit registration gives you full control over the focus sequence, which is crucial for complex application flows.
</p>
</div>
</div>
<div id="outline-container-org90ce6a2" class="outline-3">
<h3 id="org90ce6a2">Navigation Functions</h3>
<div class="outline-text-3" id="text-org90ce6a2">
<p>
With `auto_focus` enabled, Cellium automatically translates Tab and Shift + Tab key presses into calls to:
</p>

<div class="org-src-container">
<pre class="src src-erlang">focus_manager:move_focus_forward()
focus_manager:move_focus_backward()
</pre>
</div>

<p>
You can also set focus explicitly:
</p>

<div class="org-src-container">
<pre class="src src-erlang">ok = focus_manager:set_focused(WidgetID)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5120e57" class="outline-2">
<h2 id="org5120e57">Widget Rendering and Focus State</h2>
<div class="outline-text-2" id="text-org5120e57">
<p>
To render a widget based on its focus state, you can query the <code>focus_manager</code> within your <code>render</code> function.
</p>
</div>
<div id="outline-container-orgd25b6f9" class="outline-3">
<h3 id="orgd25b6f9">Retrieving the Focused Widget</h3>
<div class="outline-text-3" id="text-orgd25b6f9">
<p>
Use <code>get_focused/0</code> to find the identifier of the currently focused widget:
</p>

<div class="org-src-container">
<pre class="src src-erlang">{ok, NewFocused} = focus_manager:get_focused().
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbacf68e" class="outline-3">
<h3 id="orgbacf68e">Checking Focusability</h3>
<div class="outline-text-3" id="text-orgbacf68e">
<p>
Use <code>can_focus/1</code> to check if a widget is focusable:
</p>

<div class="org-src-container">
<pre class="src src-erlang">Focusable = focus_manager:can_focus(WidgetID)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc8f7b60" class="outline-3">
<h3 id="orgc8f7b60">Setting the focus visual indication</h3>
<div class="outline-text-3" id="text-orgc8f7b60">
<p>
Widgets that have 'focus' should appear different. For example boxes typically changes their
border style (e.g., from single to double lines).
</p>

<div class="org-src-container">
<pre class="src src-shell">| Not Focused | Focused    |
| ┌────────┐  | ╔════════╗ |
| │        │  | ║        ║ |
| │        │  | ║        ║ |
| └────────┘  | ╚════════╝ |
</pre>
</div>

<p>
Widgets that have focus focus should have the internal <code>has_focus</code> attribute set to <code>true</code>,
</p>

<p>
The helper function, <b>view:maybe_set_focus(Widget)</b>, automatically checks the <code>focus_manager</code>  and applies the
<code>has_focus</code> attribute if the widget is focused.
</p>
</div>
<div id="outline-container-org16529a1" class="outline-4">
<h4 id="org16529a1">Using the Focus Helper</h4>
<div class="outline-text-4" id="text-org16529a1">
<p>
By wrapping the widget in the <code>view:maybe_set_focus</code> function, it will query the <code>focus_manager</code> and set the has_focus attribute
value if the widget has focus.  This function returns a widget map with the focus attribute set appropriately.
</p>

<div class="org-src-container">
<pre class="src src-erlang">render(Model) -&gt;
    #{type =&gt; container,
      id =&gt; main_container,
      orientation =&gt; vertical,
      children =&gt; [
          view:maybe_set_focus( #{type =&gt; widget,
                                  widget_type =&gt; text_input,
                                  id =&gt; first_name } )
      ]
    }.
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcf28b8d" class="outline-4">
<h4 id="orgcf28b8d">Manual Setting of Focus (Direct Attribute Manipulation)</h4>
<div class="outline-text-4" id="text-orgcf28b8d">
<p>
It is still possible to manually set the <code>has_focus</code> attribute of a widget, which will render the widget
as if it had focused, however setting this value <b><b>does not</b></b> inform the <code>focus_manager</code> that this widget is
now the active focus.
</p>

<div class="org-src-container">
<pre class="src src-erlang">render(Model) -&gt;
    #{type =&gt; container,
      id =&gt; main_container,
      orientation =&gt; vertical,
      children =&gt; [
          #{type =&gt; widget,
            has_focus =&gt; true, %% Manual visual attribute set
            widget_type =&gt; text_input,
            id =&gt; first_name }
      ]
    }.
</pre>
</div>

<p>
Changes to 'what has focus' should be done in the <code>update/2</code> function with the <code>set_focus/1</code> function (see above for example).
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org0fcf6ac" class="outline-2">
<h2 id="org0fcf6ac">Demo</h2>
<div class="outline-text-2" id="text-org0fcf6ac">
<p>
<video width="480" height="320" controls="controls"><source src="././images/focus-demo.mp4" type="video/mp4"></video>
</p>
</div>
</div>
<div id="outline-container-org500f88d" class="outline-2">
<h2 id="org500f88d">Conclusion</h2>
<div class="outline-text-2" id="text-org500f88d">
<p>
While not every TUI application will need focus management, having it there should save developers from having
to write their own.  This same <code>has_focus</code> attribute should be added if you write custom widgets that could accept
focus.
</p>
</div>
</div>
<div id="outline-container-org1bad290" class="outline-2">
<h2 id="org1bad290">Resources:</h2>
<div class="outline-text-2" id="text-org1bad290">
<ul class="org-ul">
<li><p>
<b><b>TUI/GUI Design Patterns:</b></b>
</p>

<p>
Looking for discussions on <b><b>"Focus management in TUI/GUI design"</b></b> to understand advanced handling of
focus within complex container structures or forms.
</p></li>

<li><b><b>Elixir/Erlang TUI:</b></b> See <a href="https://github.com/ndreynolds/ratatouille">Ratatouille (Elixir)</a> for an alternative implementation based on
The Elm Architecture (TEA).</li>

<li>Move the cursor on the interface:
<a href="https://github.com/ndreynolds/ratatouille/issues/34">https://github.com/ndreynolds/ratatouille/issues/34</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>
