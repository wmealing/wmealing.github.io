<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-02-11 Sun 23:16 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mac OS X Sonoma midi router is broken.</title>
<meta name="generator" content="Org Mode" />
<style type="text/css" >
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" href="tufte.css" type="text/css" />
<meta name="author" content="Wade Mealing" />
<meta name="theme-color" content="#fffff8"/>
<meta name="description" content="Actual midi routing in osx." />
<meta http-equiv="Content-Security-Policy"  content="default-src 'self' 'unsafe-inline'; img-src https://*; child-src 'none';" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Mac OS X Sonoma midi router is broken.</h1>

<div id="outline-container-org0d4d13f" class="outline-2">
<h2 id="org0d4d13f">Summary:</h2>
<div class="outline-text-2" id="text-org0d4d13f">
<p>
How to connect a USB midi keyboard (Minilab3) to a synthesizer (KO2) using
a USB MIDI host.
</p>
</div>
</div>

<div id="outline-container-orgd04bf4a" class="outline-2">
<h2 id="orgd04bf4a">Introduction</h2>
<div class="outline-text-2" id="text-orgd04bf4a">
<p>
I believed there should be a method of connecting two digital musical instruments
together via USB.  This shouldn't be too much to ask.  The Musical Instrument
Digital Interface (MIDI) protocol allows computers, musical instruments and
other hardware to be controlled/synced with other devices.
</p>

<p>
In the days of old, MIDI devices had their own DIN (ROUND) style plugs where
you would connect the devices together.  While industrial looking they required
connecting to a computers "Sound Card" which may or may not have had a matching
MIDI connection.
</p>

<p>
Everyone got mad with the permutations of connectors on these older systems,
(MIDI Included), and USB was heralded as the next step forward in Serial Bus
technology.  A USB Midi standard happened, and that brings you to my recent
two purchases:
</p>
</div>

<div id="outline-container-orgd246321" class="outline-3">
<h3 id="orgd246321">ARTURIA Minilab 3</h3>
<div class="outline-text-3" id="text-orgd246321">
<p>
A compact MIDI controller known for its versatility and tactile feel, offering
an array of pads, knobs, and keys for expressive performance.
</p>
</div>
</div>

<div id="outline-container-org061a84e" class="outline-3">
<h3 id="org061a84e">KO2 Sampler Composer</h3>
<div class="outline-text-3" id="text-org061a84e">
<p>
A powerful sampler and composer, capable of transforming MIDI input into
rich, textured soundscapes and melodies.  Its the new kid on the block.
</p>

<p>
The ARTURIA has only ONE USB PORT, its USB-C and takes power over this port
as well.  Some people reccomend getting a powered "USB HUB", I happened to have
a usb hub, and it didnt seem to work.
</p>

<p>
The next option that I had was to use a real computer as a host.  I had a friend
reccomend using a "Mac laptop" as the "USB MIDI host" which would route the
MIDI data when configured.  He stated "The musicians all use macs! it must work
well, otherwise they wouldnt use it."
</p>

<p>
Fortunately, I had access to one a mac running Sonoma (10.14.1).  I plugged
both of these devices into the laptop and tried to see if it would automatically
route data between the two.
</p>

<p>
It did not.   I could however see in "Garage Band" that multiple new midi device
was available.  When pressing the keys on the keyboard  (and with a bit of
configuration on the KO2, I was able to see midi events flow from each device
to the host.
</p>

<p>
Apple suggests using the MIDI STUDIO built into OSX to be able to route midi events.  I dont know
if this ever worked, but its not working for me.
</p>

<p>
I systematically tried every possible permutation of devices being connected, disabled, enabled, restarted
and rebooted just to make sure there wasn't anything odd.
</p>

<p>
Below is an example of the routing that I had expected to work (IT DOES NOT).
</p>


<div id="org35602e8" class="figure">
<p><img src="./images/apple-midi-studio-routing-broken.png" alt="apple-midi-studio-routing-broken.png" width="800px" />
</p>
<p><span class="figure-number">Figure 1: </span>Broken midi studio in osx.</p>
</div>

<p>
Are my expections insane, other people apparently have done this ? <a href="https://support.apple.com/en-au/guide/audio-midi-setup/ams875bae1e0/mac">Apple</a> apparently believe
that its possible (Although I reckon they've somehow fucked this up).
</p>

<p>
I began to question my sanity, there were many people online who believe this work.  Surely
this has not slipped thorugh the cracks of Quality Assurance of one of the more profitable
software companies in the world.  However I assure you that it appears that it does.
</p>
</div>
</div>
</div>


<div id="outline-container-org9af25e6" class="outline-2">
<h2 id="org9af25e6">What to do ?</h2>
<div class="outline-text-2" id="text-org9af25e6">
<p>
I was told that there was some software that may help.  It was spoken about in hushed tones.
The software was named "MIDI PATCHBAY",  Which sounds like exactly what I needed.  I had an
internal visualization of an ethernet switch patch bay routing things, this sounded good.
</p>

<p>
So, I hit up "brew",  big miss.
</p>

<p>
I visited github, and found <a href="https://github.com/notahat/midi_patchbay">midi patch bay</a> by notahat, no updates for 5 years.  I tried one of the
releases and Mac OS complained that the binary was damaged (Narrator: it wasn't)
</p>

<p>
<a href="https://github.com/axmonti/midi_patchbay">Another programmer</a> forked this and made some minor improvements.  This has no "github releases"
so there is no downloadable pre-built packages.
</p>

<p>
Fortunately, I looked at the social network of this fork and found that yet another hacker has
picked it up and forked it as <a href="https://github.com/yaros-eu/midi_router">MIDI router</a>.  This is where the gold is.  It even has a "release"
on gitlab, THANK YOU yaros-eu.
</p>

<p>
I fired up the app with low expectations, Mac OSX midi studio has beaten that out of me.
It is a tiny app weighing in at 143,897 bytes unpacked, natively built for Apple Silicon.
</p>

<p>
It was simple, elegant and most importantly.. it worked.
</p>

<p>
You can add a route with the button named "Add New Route". Check out this beautiful app.
</p>


<div id="org1eb5bbc" class="figure">
<p><img src="./images/midi-router.png" alt="midi-router.png" width="800px" />
</p>
<p><span class="figure-number">Figure 2: </span>Working application to route midi.</p>
</div>

<p>
Click either of the "Input" or "Output" drop downs and it will present the current
devices on the midi bus.  Tick the route to enable, untick it to disable.
</p>

<p>
It is possible to route multiple devices to a single output. Now when I press keys on the Minilab3
the midi events are sent through to the KO2 and it works.
</p>
</div>
</div>


<div id="outline-container-org66131e0" class="outline-2">
<h2 id="org66131e0">Conclusion</h2>
<div class="outline-text-2" id="text-org66131e0">
<p>
Apple OSX midi configuration software is likely broken, I found "Midi router" that seems to route midi
messages.  It works great.
</p>
</div>
</div>

<div id="outline-container-org95c793e" class="outline-2">
<h2 id="org95c793e">Resources:</h2>
<div class="outline-text-2" id="text-org95c793e">
<p>
<a href="https://github.com/yaros-eu/midi_router/tree/master">Midi Router</a>
</p>

<p>
<a href="https://en.wikipedia.org/wiki/MIDI">MIDI (wikipedia)</a>
</p>

<p>
<a href="https://www.makeuseof.com/using-a-linux-daw-with-a-usb-connected-midi-keyboard/">Using a Linux DAW With a USB-Connected MIDI Keyboard</a>
</p>

<p>
<a href="https://www.youtube.com/watch?v=JYslZkc90GI">Programming with midi</a>
</p>
</div>
</div>
</div>
</body>
</html>
